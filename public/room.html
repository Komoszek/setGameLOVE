<html>

<head>
  <link rel="stylesheet" type="text/css" href="/css/room.css">
</head>

<body>
  <input id="startButton" type="button" value="Start" onclick="startGame()" />
  <div id="boardContainer">
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
  var selectedCards =[];
    var board = {"cards":{}};
    var hash = document.location.pathname;
    hash = hash.split("/");
    //console.log(hash);

    cardToImg = function(a) {
      var k;

      k = (a[0]+1);

      if (a[1] == 0)
        k += "O";
      else if (a[1] == 1)
        k += "S";
      else
        k += "H";

      if (a[2] == 0)
        k += "g";
      else if (a[2] == 1)
        k += "p";
      else
        k += "r";

      if (a[3] == 0)
        k += "S.svg";
      else if (a[3] == 1)
        k += "P.svg";
      else
        k += "D.svg";
        return k;
    }

    var socket = io.connect();

    socket.on('connect', function() {
      socket.emit('room', hash[2]);
    });

    socket.on('news', function(msg) {
      console.log(msg);
    });

    socket.on('game-change', function(newBoard) {
      console.log(newBoard);

      for(var card in newBoard){
        board.cards[card]=newBoard[card];
        document.getElementsByClassName("card")[card].getElementsByTagName('img')[0].src = "../icons/" + cardToImg(board.cards[card]);
      }

      //updateBoard(newBoard);
    });


    a = function() {
      socket.emit('create-room', hash[2]);

    }
    b = function() {
      socket.emit('dupa', 'dupa');

    }
    for (var i = 0; i < 19; i++) {
      board.cards[i] = -1;
      document.getElementById("boardContainer").innerHTML += '<div class="card" id="card_' + i + '" onclick="cardClick('+ i +')"><img></div>'
    }

    socket.on('board-setup', function(newBoard) {
      document.getElementById("startButton").style.display = "none";
      board.size = newBoard.length;
      board.cards = newBoard;

      for (var i = 0; i < board.size; i++) {
        document.getElementsByClassName("card")[i].getElementsByTagName('img')[0].src = "../icons/" + cardToImg(board.cards[i]);
      //  console.log(document.getElementsByClassName("card")[i].getElementsByTagName('img')[0].src);
      }

    });

    startGame = function() {
      socket.emit('start-game');
    }

    updateBoard = function(newBoard) {
      for (var i = 0; i < newBoard.length; i++) {

      }
    }

    checkSet = function() {

      var score = 0;
      for (var i = 0; i < 3; i++) {
        score = 0;
        for (var j = 0; j < 3; j++) {
          score += board.cards[selectedCards[j]][i];
        //  console.log(i + " " + board.cards[selectedCards[j]][i] + " " +  board.cards[selectedCards[j]]);
        }
        //console.log(score);
        if (score % 3) return false;
      }
      return true;
    }

    cardClick = function(i){
      if(selectedCards.indexOf(i) == -1){
        document.getElementById("card_" + i).className = "card select";
        selectedCards.push(i);
      } else {
        document.getElementById("card_" + i).className = "card"
        selectedCards.splice(selectedCards.indexOf(i),1);
      }



      if(selectedCards.length  == 3){

        if(checkSet()){
          socket.emit('check-set', selectedCards.sort(function(a, b){return a-b}));

        }


        for(var j=0;j<selectedCards.length;j++){
          document.getElementById("card_" + selectedCards[j]).className = "card";
        }
        selectedCards = [];
      }
    }
  </script>

  <input type="button" onclick="a()" />
  <input type="button" onclick="b()" />

  <a href="/room/ByFEvlM_b">s</a>

</body>

</html>
